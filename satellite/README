# Satellite Demo env installer

This is a simple demo environment provisioner for Satellite to install based on Ansible and Terraform.
It creates:
- libvirt-network with DHCP/DNS
- libvirt-pool for your VMS
- Satellite server 
- RHEL7 and RHEL8 Client for demo purposes

## Host setup

### Download Terraform

VM setup is based on Terraform, it instantiates three virtual machine, *satellite*, *el7-server* and *el8-server*, kickstarting the setup.

First you need to download and install Terraform:

    sudo yum install -y yum-utils
    sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
    sudo yum -y install terraform

### Install Ansible

You need to follow the instructions in [Ansible Website](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-the-ansible-community-package) to proceed and install Ansible on your machine.

## Lab provisioning

The provisioner consists of two playbooks, that configure the underlying components (VM, network) and prepares the guests to install Satellite.

The first playbook is **provision-lab.yml** which takes care of creating KVM resources. It only has a single variable 

    | **network_cidr** | Defaults to 192.168.211.0/24 |

### Download RHEL images

Then you need to download the FULL RHEL8 image and link it in the modules folder and create a symbolic link in the modules folder:

    ln -s /path/to/rhel7iso terraform/modules/01_satellite_instance/rhel7.iso
    ln -s /path/to/rhel7iso terraform/modules/02_client_instance/rhel7.iso
    ln -s /path/to/rhel8iso terraform/modules/02_client_instance/rhel8.iso

Review settings in **provision-lab.yml** file, containing some basic inputs:

    network_cidr = ["192.168.211.0/24"]

The terraform plan also creates an isolated virtual network, with DHCP and DNS for the specified domain.

Run the playbook to provision the VMs:

    ansible-playbook -i inventory provision-lab.yml

The setup will take a bit as it is a full install with a kickstarter. 

## Test your configuration

If the setup was good, you will be able to access your IdM server on https://idm-server.<your-domain>